<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 480" role="img" aria-label="ChIP-seq PE workflow diagram">
  <title>ChIP-seq PE Workflow</title>
  <desc>Galaxy workflow editor style visualization</desc>

  <defs>
    <!-- Galaxy editor grid pattern -->
    <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
      <path d="M 20 0 L 0 0 0 20" fill="none" stroke="#c5d5e4" stroke-width="0.5"/>
    </pattern>
    <pattern id="grid-major" width="100" height="100" patternUnits="userSpaceOnUse">
      <rect width="100" height="100" fill="url(#grid)"/>
      <path d="M 100 0 L 0 0 0 100" fill="none" stroke="#b0c4d8" stroke-width="1"/>
    </pattern>

    <style>
      .connection {
        stroke: #25537b;
        stroke-width: 4;
        fill: none;
        stroke-linecap: round;
      }
      .connection-qc {
        stroke: #25537b;
        stroke-width: 3;
        fill: none;
        stroke-linecap: round;
        stroke-dasharray: 5 3;
      }
      .node-card {
        filter: drop-shadow(1px 2px 3px rgba(0,0,0,0.15));
      }
    </style>
  </defs>

  <!-- Background with Galaxy editor grid -->
  <rect width="1200" height="480" fill="#f8f9fa"/>
  <rect width="1200" height="480" fill="url(#grid-major)"/>

  <!-- Title bar area -->
  <rect x="0" y="0" width="1200" height="45" fill="#25537b"/>
  <text x="20" y="28" font-family="system-ui, -apple-system, sans-serif" font-size="16" font-weight="600" fill="white">ChIP-seq PE</text>
  <text x="130" y="28" font-family="system-ui, sans-serif" font-size="12" fill="rgba(255,255,255,0.7)">Paired-End ChIP-seq Analysis Pipeline</text>

  <!-- ==================== CONNECTIONS (drawn first, behind nodes) ==================== -->

  <!-- PE FASTQs (200,145) → fastp input (280,145) -->
  <path class="connection" d="M 200 145 C 240 145, 240 145, 280 145"/>

  <!-- fastp output (480,145) → Bowtie2 input (560,145) -->
  <path class="connection" d="M 480 145 C 520 145, 520 145, 560 145"/>

  <!-- Bowtie2 output (760,145) → Filter input (840,145) -->
  <path class="connection" d="M 760 145 C 800 145, 800 145, 840 145"/>

  <!-- Filter output (1040,145) → MACS2 input (1060,145) -->
  <path class="connection" d="M 1040 145 C 1050 145, 1050 145, 1060 145"/>

  <!-- MACS2 output 1 → Peaks -->
  <path class="connection" d="M 1110 270 C 1110 310, 1030 310, 1030 340"/>

  <!-- MACS2 output 2 → Coverage -->
  <path class="connection" d="M 1150 270 C 1150 310, 1130 310, 1130 340"/>

  <!-- QC: fastp bottom (380,200) → MultiQC input top -->
  <path class="connection-qc" d="M 380 200 C 380 280, 120 280, 120 355"/>

  <!-- QC: Bowtie2 bottom (660,200) → MultiQC -->
  <path class="connection-qc" d="M 660 200 C 660 300, 160 300, 160 355"/>

  <!-- QC: MACS2 bottom (1110,270) → MultiQC -->
  <path class="connection-qc" d="M 1110 270 C 1110 320, 200 320, 200 355"/>

  <!-- ==================== NODES ==================== -->

  <!-- NODE: PE FASTQs (Input) at x=20 -->
  <g class="node-card" transform="translate(20, 100)">
    <rect width="180" height="90" rx="4" fill="white" stroke="#25537b" stroke-width="1"/>
    <rect width="180" height="28" rx="4" fill="#25537b"/>
    <rect x="0" y="24" width="180" height="4" fill="#25537b"/>
    <text x="10" y="19" font-family="system-ui, sans-serif" font-size="11" fill="rgba(255,255,255,0.7)">1:</text>
    <text x="26" y="19" font-family="system-ui, sans-serif" font-size="11" font-weight="600" fill="white">PE FASTQs</text>
    <text x="90" y="55" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#495057">Paired Collection</text>
    <text x="90" y="72" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#868e96">Input Dataset</text>
    <!-- Output terminal at right edge, center height of body -->
    <circle cx="180" cy="45" r="6" fill="white" stroke="#25537b" stroke-width="2"/>
  </g>

  <!-- NODE: fastp at x=280 -->
  <g class="node-card" transform="translate(280, 100)">
    <rect width="200" height="100" rx="4" fill="white" stroke="#25537b" stroke-width="1"/>
    <rect width="200" height="28" rx="4" fill="#25537b"/>
    <rect x="0" y="24" width="200" height="4" fill="#25537b"/>
    <text x="10" y="19" font-family="system-ui, sans-serif" font-size="11" fill="rgba(255,255,255,0.7)">2:</text>
    <text x="26" y="19" font-family="system-ui, sans-serif" font-size="11" font-weight="600" fill="white">fastp</text>
    <text x="100" y="55" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#495057">Quality Control &amp; Trimming</text>
    <text x="100" y="72" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#868e96">Adapter removal, filtering</text>
    <line x1="10" y1="82" x2="190" y2="82" stroke="#25537b" stroke-width="1" stroke-dasharray="2 2"/>
    <!-- Input terminal at left -->
    <circle cx="0" cy="45" r="6" fill="white" stroke="#25537b" stroke-width="2"/>
    <!-- Output terminal at right -->
    <circle cx="200" cy="45" r="6" fill="white" stroke="#25537b" stroke-width="2"/>
    <!-- QC output at bottom -->
    <circle cx="100" cy="100" r="5" fill="white" stroke="#25537b" stroke-width="1.5"/>
  </g>

  <!-- NODE: Bowtie2 at x=560 -->
  <g class="node-card" transform="translate(560, 100)">
    <rect width="200" height="100" rx="4" fill="white" stroke="#25537b" stroke-width="1"/>
    <rect width="200" height="28" rx="4" fill="#25537b"/>
    <rect x="0" y="24" width="200" height="4" fill="#25537b"/>
    <text x="10" y="19" font-family="system-ui, sans-serif" font-size="11" fill="rgba(255,255,255,0.7)">3:</text>
    <text x="26" y="19" font-family="system-ui, sans-serif" font-size="11" font-weight="600" fill="white">Bowtie2</text>
    <text x="100" y="55" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#495057">Read Mapping</text>
    <text x="100" y="72" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#868e96">Align to reference genome</text>
    <line x1="10" y1="82" x2="190" y2="82" stroke="#25537b" stroke-width="1" stroke-dasharray="2 2"/>
    <circle cx="0" cy="45" r="6" fill="white" stroke="#25537b" stroke-width="2"/>
    <circle cx="200" cy="45" r="6" fill="white" stroke="#25537b" stroke-width="2"/>
    <circle cx="100" cy="100" r="5" fill="white" stroke="#25537b" stroke-width="1.5"/>
  </g>

  <!-- NODE: Filter BAM at x=840 -->
  <g class="node-card" transform="translate(840, 100)">
    <rect width="200" height="90" rx="4" fill="white" stroke="#25537b" stroke-width="1"/>
    <rect width="200" height="28" rx="4" fill="#25537b"/>
    <rect x="0" y="24" width="200" height="4" fill="#25537b"/>
    <text x="10" y="19" font-family="system-ui, sans-serif" font-size="11" fill="rgba(255,255,255,0.7)">4:</text>
    <text x="26" y="19" font-family="system-ui, sans-serif" font-size="11" font-weight="600" fill="white">Filter BAM</text>
    <text x="100" y="55" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#495057">MAPQ ≥ 30</text>
    <text x="100" y="72" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#868e96">Filter proper pairs</text>
    <circle cx="0" cy="45" r="6" fill="white" stroke="#25537b" stroke-width="2"/>
    <circle cx="200" cy="45" r="6" fill="white" stroke="#25537b" stroke-width="2"/>
  </g>

  <!-- NODE: MACS2 at x=1060 -->
  <g class="node-card" transform="translate(1060, 100)">
    <rect width="120" height="170" rx="4" fill="white" stroke="#25537b" stroke-width="2"/>
    <rect width="120" height="28" rx="4" fill="#25537b"/>
    <rect x="0" y="24" width="120" height="4" fill="#25537b"/>
    <text x="10" y="19" font-family="system-ui, sans-serif" font-size="11" fill="rgba(255,255,255,0.7)">5:</text>
    <text x="26" y="19" font-family="system-ui, sans-serif" font-size="11" font-weight="700" fill="white">MACS2</text>
    <text x="60" y="55" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" font-weight="600" fill="#495057">Peak Calling</text>
    <text x="60" y="72" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#868e96">Find binding sites</text>
    <line x1="10" y1="85" x2="110" y2="85" stroke="#25537b" stroke-width="1" stroke-dasharray="2 2"/>
    <!-- Outputs listed -->
    <text x="15" y="102" font-family="system-ui, sans-serif" font-size="9" fill="#495057">narrowPeak</text>
    <text x="15" y="118" font-family="system-ui, sans-serif" font-size="9" fill="#495057">coverage (bigWig)</text>
    <text x="15" y="134" font-family="system-ui, sans-serif" font-size="9" fill="#868e96">summits</text>
    <text x="15" y="150" font-family="system-ui, sans-serif" font-size="9" fill="#868e96">model</text>
    <!-- Input terminal -->
    <circle cx="0" cy="45" r="6" fill="white" stroke="#25537b" stroke-width="2"/>
    <!-- Output terminals on bottom -->
    <circle cx="50" cy="170" r="5" fill="white" stroke="#25537b" stroke-width="1.5"/>
    <circle cx="90" cy="170" r="5" fill="white" stroke="#25537b" stroke-width="1.5"/>
  </g>

  <!-- NODE: MultiQC Report at y=355 -->
  <g class="node-card" transform="translate(60, 355)">
    <rect width="200" height="70" rx="4" fill="white" stroke="#10b981" stroke-width="1"/>
    <rect width="200" height="24" rx="4" fill="#10b981"/>
    <rect x="0" y="20" width="200" height="4" fill="#10b981"/>
    <text x="10" y="17" font-family="system-ui, sans-serif" font-size="11" font-weight="600" fill="white">MultiQC</text>
    <text x="100" y="45" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#495057">Aggregated QC Report</text>
    <text x="100" y="60" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#868e96">HTML report</text>
    <!-- Input terminals at top (at x=60,100,140 relative, so absolute 120,160,200) -->
    <circle cx="60" cy="0" r="5" fill="white" stroke="#10b981" stroke-width="2"/>
    <circle cx="100" cy="0" r="5" fill="white" stroke="#10b981" stroke-width="2"/>
    <circle cx="140" cy="0" r="5" fill="white" stroke="#10b981" stroke-width="2"/>
  </g>

  <!-- NODE: Peaks Output at x=980 y=340 -->
  <g class="node-card" transform="translate(980, 340)">
    <rect width="100" height="50" rx="4" fill="white" stroke="#f97316" stroke-width="1.5"/>
    <rect width="100" height="20" rx="4" fill="#f97316"/>
    <rect x="0" y="16" width="100" height="4" fill="#f97316"/>
    <text x="50" y="14" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" font-weight="600" fill="white">Peaks</text>
    <text x="50" y="38" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#868e96">narrowPeak (BED)</text>
    <!-- Input terminal at top -->
    <circle cx="50" cy="0" r="5" fill="white" stroke="#f97316" stroke-width="2"/>
  </g>

  <!-- NODE: Coverage Output at x=1090 y=340 -->
  <g class="node-card" transform="translate(1090, 340)">
    <rect width="100" height="50" rx="4" fill="white" stroke="#f97316" stroke-width="1.5"/>
    <rect width="100" height="20" rx="4" fill="#f97316"/>
    <rect x="0" y="16" width="100" height="4" fill="#f97316"/>
    <text x="50" y="14" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" font-weight="600" fill="white">Coverage</text>
    <text x="50" y="38" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#868e96">bigWig track</text>
    <!-- Input terminal at top -->
    <circle cx="40" cy="0" r="5" fill="white" stroke="#f97316" stroke-width="2"/>
  </g>

  <!-- Legend -->
  <g transform="translate(350, 440)">
    <text x="0" y="0" font-family="system-ui, sans-serif" font-size="10" font-weight="600" fill="#495057">Legend:</text>
    <line x1="60" y1="-4" x2="100" y2="-4" stroke="#25537b" stroke-width="4" stroke-linecap="round"/>
    <text x="108" y="0" font-family="system-ui, sans-serif" font-size="9" fill="#6c757d">Data flow</text>
    <line x1="180" y1="-4" x2="220" y2="-4" stroke="#25537b" stroke-width="3" stroke-linecap="round" stroke-dasharray="5 3"/>
    <text x="228" y="0" font-family="system-ui, sans-serif" font-size="9" fill="#6c757d">QC metrics</text>
    <circle cx="300" cy="-4" r="5" fill="white" stroke="#25537b" stroke-width="2"/>
    <text x="312" y="0" font-family="system-ui, sans-serif" font-size="9" fill="#6c757d">Connection terminal</text>
  </g>

</svg>
