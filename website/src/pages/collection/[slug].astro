---
import BaseLayout from "../../layouts/BaseLayout.astro";
import IWCHeader from "../../components/IWCHeader.astro";
import CollectionHero from "../../components/CollectionHero.vue";
import CollectionContent from "../../components/CollectionContent.vue";
import { loadManifest, getAllCollections } from "../../utils/manifest";

export async function getStaticPaths() {
    const collections = await loadManifest();
    const allCollections = getAllCollections(collections);

    return allCollections.map((collection) => {
        const slug = collection.toLowerCase().replace(/ /g, "-");
        return {
            params: { slug },
            props: { collectionName: collection },
        };
    });
}

const { collectionName } = Astro.props;

const baseUrl = "https://iwc.galaxyproject.org";
const title = `${collectionName} - Intergalactic Workflow Commission`;
const description = `Discover ${collectionName} workflows - Ready-to-use, open-source pipelines with sample data and training materials`;
const ogDescription = `Discover ${collectionName} workflows on Galaxy`;
---

<BaseLayout
    title={title}
    description={description}
    hasHero={true}
    ogTitle={title}
    ogDescription={ogDescription}
    ogImage={`${baseUrl}/iwc_logo.png`}
    ogType="website"
    twitterCard="summary"
    twitterTitle={title}
    twitterDescription={ogDescription}
    twitterImage={`${baseUrl}/iwc_logo.png`}>
    <IWCHeader slot="header" />

    <div slot="hero">
        <div>
            <div class="flex p-4 items-center" style="flex-direction: column">
                <h1 class="text-4xl my-8 text-white text-center font-bold">{collectionName} Workflows</h1>
            </div>
            <div class="w-full p-4 text-center relative z-10">
                <CollectionHero collectionName={collectionName} client:load />
                <div class="max-w-6xl w-full mx-auto">
                    <input
                        id="collection-search"
                        type="text"
                        placeholder={`Search ${collectionName} workflows`}
                        class="w-full p-3 border border-ebony-clay-200 bg-white rounded-lg text-lg focus:outline-none focus:ring-2 focus:ring-hokey-pokey-500 focus:border-transparent transition-shadow"
                    />
                </div>
                <div class="mt-4">
                    <a href="/" class="text-white hover:text-hokey-pokey-300 underline transition-colors">
                        ‚Üê Back to all workflows
                    </a>
                </div>
            </div>
        </div>
    </div>

    <CollectionContent slot="content" collectionName={collectionName} client:only="vue" />
</BaseLayout>

<script>
    // Initialize workflow collections
    import { setWorkflowCollections } from "../../stores/workflowStore";

    fetch("/workflow_manifest.json")
        .then((res) => res.json())
        .then((collections) => {
            setWorkflowCollections(collections);
        });
</script>
