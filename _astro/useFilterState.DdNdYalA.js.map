{"version":3,"file":"useFilterState.DdNdYalA.js","sources":["../../src/composables/useFilterState.ts"],"sourcesContent":["import { computed, onMounted, ref } from \"vue\";\nimport { useStore } from \"@nanostores/vue\";\nimport { selectedFilters, toggleFilter, collectionToSlug, setFilterFromUrl } from \"../stores/workflowStore\";\nimport type { SearchIndexEntry } from \"../models/workflow\";\n\nexport interface FilterStateOptions {\n    workflows: SearchIndexEntry[];\n    closeOnSelect?: () => void;\n}\n\nexport function useFilterState(options: FilterStateOptions) {\n    const { workflows, closeOnSelect } = options;\n\n    const storeSelected = useStore(selectedFilters);\n\n    // Use local ref to avoid hydration mismatch - starts empty like SSR\n    const selected = ref<string[]>([]);\n    const isHydrated = ref(false);\n\n    // Compute collections from workflows\n    const collections = computed(() => {\n        const collectionSet = new Set<string>();\n        for (const w of workflows) {\n            for (const c of w.collections) {\n                collectionSet.add(c);\n            }\n        }\n        return Array.from(collectionSet).sort();\n    });\n\n    // Count workflows per collection\n    const collectionCounts = computed(() => {\n        const counts: Record<string, number> = {};\n        for (const w of workflows) {\n            for (const c of w.collections) {\n                counts[c] = (counts[c] || 0) + 1;\n            }\n        }\n        return counts;\n    });\n\n    // Sort collections by workflow count (descending)\n    const sortedCollections = computed(() => {\n        return [...collections.value].sort((a, b) => {\n            return (collectionCounts.value[b] || 0) - (collectionCounts.value[a] || 0);\n        });\n    });\n\n    onMounted(() => {\n        setFilterFromUrl();\n        selected.value = [...storeSelected.value];\n        isHydrated.value = true;\n    });\n\n    // Keep local ref in sync with store changes (only after hydration)\n    selectedFilters.subscribe((value) => {\n        if (isHydrated.value) {\n            selected.value = [...value];\n        }\n    });\n\n    function handleFilterClick(filter: string): void {\n        const currentPath = window.location.pathname;\n\n        if (currentPath === \"/\") {\n            const wasSelected = selected.value.includes(filter);\n            toggleFilter(filter);\n\n            const params = new URLSearchParams(window.location.search);\n            if (wasSelected) {\n                params.delete(\"filter\");\n            } else {\n                params.set(\"filter\", filter);\n            }\n\n            const newUrl = params.toString() ? `?${params.toString()}` : \"/\";\n            window.history.pushState({}, \"\", newUrl);\n        } else {\n            window.location.href = `/collection/${collectionToSlug(filter)}`;\n        }\n\n        closeOnSelect?.();\n    }\n\n    return {\n        selected,\n        collections,\n        collectionCounts,\n        sortedCollections,\n        handleFilterClick,\n    };\n}\n"],"names":["useFilterState","options","workflows","closeOnSelect","storeSelected","useStore","selectedFilters","selected","ref","isHydrated","collections","computed","collectionSet","w","c","collectionCounts","counts","sortedCollections","a","b","onMounted","setFilterFromUrl","value","handleFilterClick","filter","wasSelected","toggleFilter","params","newUrl","collectionToSlug"],"mappings":"qlBAUO,SAASA,EAAeC,EAA6B,CACxD,KAAM,CAAE,UAAAC,EAAW,cAAAC,CAAA,EAAkBF,EAE/BG,EAAgBC,EAASC,CAAe,EAGxCC,EAAWC,EAAc,EAAE,EAC3BC,EAAaD,EAAI,EAAK,EAGtBE,EAAcC,EAAS,IAAM,CAC/B,MAAMC,MAAoB,IAC1B,UAAWC,KAAKX,EACZ,UAAWY,KAAKD,EAAE,YACdD,EAAc,IAAIE,CAAC,EAG3B,OAAO,MAAM,KAAKF,CAAa,EAAE,KAAA,CACrC,CAAC,EAGKG,EAAmBJ,EAAS,IAAM,CACpC,MAAMK,EAAiC,CAAA,EACvC,UAAWH,KAAKX,EACZ,UAAWY,KAAKD,EAAE,YACdG,EAAOF,CAAC,GAAKE,EAAOF,CAAC,GAAK,GAAK,EAGvC,OAAOE,CACX,CAAC,EAGKC,EAAoBN,EAAS,IACxB,CAAC,GAAGD,EAAY,KAAK,EAAE,KAAK,CAACQ,EAAGC,KAC3BJ,EAAiB,MAAMI,CAAC,GAAK,IAAMJ,EAAiB,MAAMG,CAAC,GAAK,EAC3E,CACJ,EAEDE,EAAU,IAAM,CACZC,EAAA,EACAd,EAAS,MAAQ,CAAC,GAAGH,EAAc,KAAK,EACxCK,EAAW,MAAQ,EACvB,CAAC,EAGDH,EAAgB,UAAWgB,GAAU,CAC7Bb,EAAW,QACXF,EAAS,MAAQ,CAAC,GAAGe,CAAK,EAElC,CAAC,EAED,SAASC,EAAkBC,EAAsB,CAG7C,GAFoB,OAAO,SAAS,WAEhB,IAAK,CACrB,MAAMC,EAAclB,EAAS,MAAM,SAASiB,CAAM,EAClDE,EAAaF,CAAM,EAEnB,MAAMG,EAAS,IAAI,gBAAgB,OAAO,SAAS,MAAM,EACrDF,EACAE,EAAO,OAAO,QAAQ,EAEtBA,EAAO,IAAI,SAAUH,CAAM,EAG/B,MAAMI,EAASD,EAAO,WAAa,IAAIA,EAAO,UAAU,GAAK,IAC7D,OAAO,QAAQ,UAAU,CAAA,EAAI,GAAIC,CAAM,CAC3C,MACI,OAAO,SAAS,KAAO,eAAeC,EAAiBL,CAAM,CAAC,GAGlErB,IAAA,CACJ,CAEA,MAAO,CACH,SAAAI,EACA,YAAAG,EACA,iBAAAK,EACA,kBAAAE,EACA,kBAAAM,CAAA,CAER"}