{"version":3,"file":"WorkflowGrid.D28D4Frm.js","sources":["../../src/components/WorkflowGrid.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { computed, onMounted, ref } from \"vue\";\nimport { useStore } from \"@nanostores/vue\";\nimport Fuse from \"fuse.js\";\nimport {\n    selectedFilters,\n    setFilterFromUrl,\n    setSearchFromUrl,\n    updateSearchUrl,\n    viewMode,\n    searchQuery as searchQueryStore,\n    searchIndex,\n} from \"../stores/workflowStore\";\nimport WorkflowCard from \"./WorkflowCard.vue\";\nimport WorkflowListItem from \"./WorkflowListItem.vue\";\nimport ViewToggle from \"./ViewToggle.vue\";\nimport type { SearchIndexEntry } from \"../models/workflow\";\n\nconst props = defineProps<{\n    workflows: SearchIndexEntry[];\n}>();\n\n// Initialize store with prop data immediately (for other components that read from store)\nsearchIndex.set(props.workflows);\n\nconst mode = useStore(viewMode);\n\n// Use local refs to avoid hydration mismatch - start empty like SSR\nconst localFilters = ref<string[]>([]);\nconst localSearchQuery = ref(\"\");\nconst isHydrated = ref(false);\nconst isSearching = computed(() => localSearchQuery.value.trim().length > 0);\n\n// Sort workflows by updated date (use props directly, no store subscription needed)\nconst sortedWorkflows = computed(() =>\n    props.workflows.slice().sort((a, b) => new Date(b.updated).getTime() - new Date(a.updated).getTime()),\n);\n\n// Fuse.js configuration (flat structure now)\nconst fuseOptions = {\n    keys: [\n        { name: \"name\", weight: 0.5 },\n        { name: \"annotation\", weight: 0.4 },\n        { name: \"tags\", weight: 0.2 },\n        { name: \"collections\", weight: 0.1 },\n    ],\n    threshold: 0.4,\n    ignoreLocation: true, // Match anywhere in the string equally\n    minMatchCharLength: 2,\n};\n\nconst fuse = computed(() => new Fuse(sortedWorkflows.value, fuseOptions));\n\n// Filtered workflows (use local refs for hydration safety)\nconst filteredWorkflows = computed(() => {\n    const matchesSelectedFilters = (workflow: SearchIndexEntry): boolean => {\n        return (\n            !localFilters.value.length || localFilters.value.every((filter) => workflow.collections.includes(filter))\n        );\n    };\n\n    if (!localSearchQuery.value) {\n        return sortedWorkflows.value.filter(matchesSelectedFilters);\n    } else {\n        const searchResults = fuse.value.search(localSearchQuery.value.trim());\n        const fuzzyMatches = searchResults.map((result) => result.item);\n        return fuzzyMatches.filter(matchesSelectedFilters);\n    }\n});\n\n// Computed for results count display\nconst _hasActiveFilters = computed(() => isSearching.value || localFilters.value.length > 0);\nconst selectedCategory = computed(() => (localFilters.value.length > 0 ? localFilters.value[0] : null));\n\n// Debounced URL update for search\nlet urlUpdateTimeout: ReturnType<typeof setTimeout>;\nconst handleSearchInput = (e: Event) => {\n    const value = (e.target as HTMLInputElement).value;\n    localSearchQuery.value = value;\n    searchQueryStore.set(value);\n\n    clearTimeout(urlUpdateTimeout);\n    urlUpdateTimeout = setTimeout(() => {\n        updateSearchUrl(value);\n    }, 300);\n};\n\nonMounted(() => {\n    setFilterFromUrl();\n    setSearchFromUrl();\n\n    // Sync local refs with store after hydration\n    localFilters.value = selectedFilters.get();\n    localSearchQuery.value = searchQueryStore.get();\n    isHydrated.value = true;\n\n    // Initialize view mode from localStorage\n    const savedViewMode = localStorage.getItem(\"iwc-view-mode\");\n    if (savedViewMode === \"list\" || savedViewMode === \"grid\") {\n        viewMode.set(savedViewMode);\n    }\n});\n\n// Keep local refs in sync with store changes (only after hydration)\nselectedFilters.subscribe((value) => {\n    if (isHydrated.value) {\n        localFilters.value = value;\n    }\n});\nsearchQueryStore.subscribe((value) => {\n    if (isHydrated.value) {\n        localSearchQuery.value = value;\n    }\n});\n</script>\n\n<template>\n    <div class=\"w-full\">\n        <!-- Search input -->\n        <div class=\"mb-4\">\n            <input\n                type=\"text\"\n                :value=\"localSearchQuery\"\n                placeholder=\"Search workflows...\"\n                class=\"w-full p-3 border border-chicago-200 bg-white rounded-lg text-lg focus:outline-none focus:ring-2 focus:ring-hokey-pokey-500 focus:border-transparent transition-shadow\"\n                @input=\"handleSearchInput\" />\n        </div>\n\n        <!-- Results header row -->\n        <div class=\"flex justify-between items-center mb-4\">\n            <Transition name=\"fade\" mode=\"out-in\">\n                <!-- Searching with category -->\n                <p v-if=\"isSearching && selectedCategory\" key=\"search-category\" class=\"text-chicago-600 text-sm\">\n                    Found <span class=\"font-semibold\">{{ filteredWorkflows.length }}</span\n                    >&nbsp;<span class=\"font-bold text-ebony-clay-900\">{{ selectedCategory }}</span\n                    >&nbsp;workflows matching your query\n                </p>\n                <!-- Searching only -->\n                <p v-else-if=\"isSearching\" key=\"search\" class=\"text-chicago-600 text-sm\">\n                    Found <span class=\"font-semibold\">{{ filteredWorkflows.length }}</span> workflows\n                </p>\n                <!-- Category only -->\n                <p v-else-if=\"selectedCategory\" key=\"category\" class=\"text-chicago-600 text-sm\">\n                    <span class=\"font-semibold\">{{ filteredWorkflows.length }}</span\n                    >&nbsp;<span class=\"font-bold text-ebony-clay-900\">{{ selectedCategory }}</span\n                    >&nbsp;workflows\n                </p>\n                <!-- No filters -->\n                <p v-else key=\"total\" class=\"text-chicago-500 text-sm\">\n                    <span class=\"font-semibold\">{{ sortedWorkflows.length }}</span> <span>workflows</span>\n                </p>\n            </Transition>\n            <ViewToggle />\n        </div>\n\n        <!-- View transition wrapper -->\n        <Transition name=\"view-fade\" mode=\"out-in\">\n            <!-- List View -->\n            <div\n                v-if=\"mode === 'list'\"\n                id=\"workflows\"\n                key=\"list\"\n                class=\"flex flex-col border border-ebony-clay-100 rounded-xl overflow-hidden shadow-sm\">\n                <TransitionGroup name=\"list-stagger\" appear>\n                    <WorkflowListItem\n                        v-for=\"(workflow, index) in filteredWorkflows\"\n                        :key=\"workflow.uuid\"\n                        :workflow=\"workflow\"\n                        :style=\"{ '--stagger-delay': `${Math.min(index * 20, 300)}ms` }\" />\n                </TransitionGroup>\n            </div>\n\n            <!-- Grid View -->\n            <div v-else id=\"workflows\" key=\"grid\" class=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                <TransitionGroup name=\"grid-stagger\" appear>\n                    <WorkflowCard\n                        v-for=\"(workflow, index) in filteredWorkflows\"\n                        :key=\"workflow.uuid\"\n                        :workflow=\"workflow\"\n                        :style=\"{ '--stagger-delay': `${Math.min(index * 30, 400)}ms` }\"\n                        compact />\n                </TransitionGroup>\n            </div>\n        </Transition>\n\n        <!-- External workflow sources / empty state -->\n        <div\n            class=\"mt-8 py-5 px-6 rounded-lg border border-chicago-200 bg-chicago-50 text-center text-sm text-chicago-600\">\n            <p v-if=\"filteredWorkflows.length === 0\" class=\"text-xl text-chicago-500 mb-3\">\n                No workflows found matching your criteria.\n            </p>\n            <span v-if=\"filteredWorkflows.length === 0\">Try searching for Galaxy workflows on </span>\n            <span v-else>Find more Galaxy workflows on </span>\n            <a\n                href=\"https://dockstore.org/search?descriptorType=Galaxy&descriptorType=gxformat2&entryType=workflows&searchMode=files\"\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                class=\"text-hokey-pokey-700 underline hover:text-hokey-pokey-900\"\n                >Dockstore</a\n            >,\n            <a\n                href=\"https://workflowhub.eu/workflows?filter%5Bworkflow_type%5D=galaxy\"\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                class=\"text-hokey-pokey-700 underline hover:text-hokey-pokey-900\"\n                >WorkflowHub</a\n            >, and the\n            <a\n                href=\"https://training.galaxyproject.org/training-material/workflows/list\"\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                class=\"text-hokey-pokey-700 underline hover:text-hokey-pokey-900\"\n                >Galaxy Training Network</a\n            >.\n        </div>\n    </div>\n</template>\n\n<style scoped>\n/* View switch transition */\n.view-fade-enter-active,\n.view-fade-leave-active {\n    transition:\n        opacity 0.2s ease,\n        transform 0.2s ease;\n}\n\n.view-fade-enter-from {\n    opacity: 0;\n    transform: translateY(8px);\n}\n\n.view-fade-leave-to {\n    opacity: 0;\n    transform: translateY(-8px);\n}\n\n/* List stagger animation */\n.list-stagger-enter-active {\n    transition:\n        opacity 0.3s ease,\n        transform 0.3s ease;\n    transition-delay: var(--stagger-delay, 0ms);\n}\n\n.list-stagger-enter-from {\n    opacity: 0;\n    transform: translateX(-12px);\n}\n\n/* Grid stagger animation */\n.grid-stagger-enter-active {\n    transition:\n        opacity 0.35s ease,\n        transform 0.35s ease;\n    transition-delay: var(--stagger-delay, 0ms);\n}\n\n.grid-stagger-enter-from {\n    opacity: 0;\n    transform: scale(0.95) translateY(10px);\n}\n\n/* Simple fade for empty state */\n.fade-enter-active,\n.fade-leave-active {\n    transition: opacity 0.3s ease;\n}\n\n.fade-enter-from,\n.fade-leave-to {\n    opacity: 0;\n}\n</style>\n"],"names":["props","__props","searchIndex","mode","useStore","viewMode","localFilters","ref","localSearchQuery","isHydrated","isSearching","computed","sortedWorkflows","a","b","fuseOptions","fuse","Fuse","filteredWorkflows","matchesSelectedFilters","workflow","filter","result","_hasActiveFilters","selectedCategory","urlUpdateTimeout","handleSearchInput","e","value","searchQueryStore","updateSearchUrl","onMounted","setFilterFromUrl","setSearchFromUrl","selectedFilters","savedViewMode","_hoisted_1","_hoisted_2","_hoisted_4","_hoisted_6","_hoisted_7","_hoisted_9","_hoisted_11","_hoisted_12","_hoisted_14","_hoisted_17","_openBlock","_createElementBlock","_createElementVNode","$setup","_hoisted_3","_createVNode","_Transition","_hoisted_5","_cache","_createTextVNode","_toDisplayString","_hoisted_8","_hoisted_10","_hoisted_13","_hoisted_15","_TransitionGroup","_Fragment","_renderList","index","_createBlock","_normalizeStyle","_hoisted_16","_hoisted_18","_createCommentVNode","_hoisted_19"],"mappings":"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"}