import{s as A,a as G,S as N}from"./chunk-DI55MBZ5.zt6Gmt9u.js";import{_ as f,c as t,d as M,l as S,e as P,k as z,S as W,T as U,P as C,u as D}from"./MarkdownRenderer.4Pi2mfG9.js";import{G as F}from"./graph.Cy45p2Vg.js";import{l as I}from"./layout.CQX4ElT0.js";import"./chunk-55IACEB6.CSEzvnvS.js";import"./chunk-QN33PNHL.n1hJ10rh.js";/* empty css                        */import"./_plugin-vue_export-helper.DPSXizdw.js";import"./runtime-core.esm-bundler.CqOkuUpN.js";import"./_baseUniq.BvipEzPS.js";import"./_basePickBy.CGbm8LdA.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};e.SENTRY_RELEASE={id:"4a18dac1384509038f0a89ae507bd0675272490d"};var a=new e.Error().stack;a&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[a]="cdea615c-41f1-42d8-917a-40496ec36679",e._sentryDebugIdIdentifier="sentry-dbid-cdea615c-41f1-42d8-917a-40496ec36679")}catch{}})();var O=f(e=>e.append("circle").attr("class","start-state").attr("r",t().state.sizeUnit).attr("cx",t().state.padding+t().state.sizeUnit).attr("cy",t().state.padding+t().state.sizeUnit),"drawStartState"),J=f(e=>e.append("line").style("stroke","grey").style("stroke-dasharray","3").attr("x1",t().state.textHeight).attr("class","divider").attr("x2",t().state.textHeight*2).attr("y1",0).attr("y2",0),"drawDivider"),X=f((e,a)=>{const s=e.append("text").attr("x",2*t().state.padding).attr("y",t().state.textHeight+2*t().state.padding).attr("font-size",t().state.fontSize).attr("class","state-title").text(a.id),c=s.node().getBBox();return e.insert("rect",":first-child").attr("x",t().state.padding).attr("y",t().state.padding).attr("width",c.width+2*t().state.padding).attr("height",c.height+2*t().state.padding).attr("rx",t().state.radius),s},"drawSimpleState"),Y=f((e,a)=>{const s=f(function(g,b,m){const v=g.append("tspan").attr("x",2*t().state.padding).text(b);m||v.attr("dy",t().state.textHeight)},"addTspan"),n=e.append("text").attr("x",2*t().state.padding).attr("y",t().state.textHeight+1.3*t().state.padding).attr("font-size",t().state.fontSize).attr("class","state-title").text(a.descriptions[0]).node().getBBox(),l=n.height,x=e.append("text").attr("x",t().state.padding).attr("y",l+t().state.padding*.4+t().state.dividerMargin+t().state.textHeight).attr("class","state-description");let i=!0,d=!0;a.descriptions.forEach(function(g){i||(s(x,g,d),d=!1),i=!1});const w=e.append("line").attr("x1",t().state.padding).attr("y1",t().state.padding+l+t().state.dividerMargin/2).attr("y2",t().state.padding+l+t().state.dividerMargin/2).attr("class","descr-divider"),p=x.node().getBBox(),o=Math.max(p.width,n.width);return w.attr("x2",o+3*t().state.padding),e.insert("rect",":first-child").attr("x",t().state.padding).attr("y",t().state.padding).attr("width",o+2*t().state.padding).attr("height",p.height+l+2*t().state.padding).attr("rx",t().state.radius),e},"drawDescrState"),$=f((e,a,s)=>{const c=t().state.padding,n=2*t().state.padding,l=e.node().getBBox(),x=l.width,i=l.x,d=e.append("text").attr("x",0).attr("y",t().state.titleShift).attr("font-size",t().state.fontSize).attr("class","state-title").text(a.id),p=d.node().getBBox().width+n;let o=Math.max(p,x);o===x&&(o=o+n);let g;const b=e.node().getBBox();a.doc,g=i-c,p>x&&(g=(x-o)/2+c),Math.abs(i-b.x)<c&&p>x&&(g=i-(p-x)/2);const m=1-t().state.textHeight;return e.insert("rect",":first-child").attr("x",g).attr("y",m).attr("class",s?"alt-composit":"composit").attr("width",o).attr("height",b.height+t().state.textHeight+t().state.titleShift+1).attr("rx","0"),d.attr("x",g+c),p<=x&&d.attr("x",i+(o-n)/2-p/2+c),e.insert("rect",":first-child").attr("x",g).attr("y",t().state.titleShift-t().state.textHeight-t().state.padding).attr("width",o).attr("height",t().state.textHeight*3).attr("rx",t().state.radius),e.insert("rect",":first-child").attr("x",g).attr("y",t().state.titleShift-t().state.textHeight-t().state.padding).attr("width",o).attr("height",b.height+3+2*t().state.textHeight).attr("rx",t().state.radius),e},"addTitleAndBox"),q=f(e=>(e.append("circle").attr("class","end-state-outer").attr("r",t().state.sizeUnit+t().state.miniPadding).attr("cx",t().state.padding+t().state.sizeUnit+t().state.miniPadding).attr("cy",t().state.padding+t().state.sizeUnit+t().state.miniPadding),e.append("circle").attr("class","end-state-inner").attr("r",t().state.sizeUnit).attr("cx",t().state.padding+t().state.sizeUnit+2).attr("cy",t().state.padding+t().state.sizeUnit+2)),"drawEndState"),Z=f((e,a)=>{let s=t().state.forkWidth,c=t().state.forkHeight;if(a.parentId){let n=s;s=c,c=n}return e.append("rect").style("stroke","black").style("fill","black").attr("width",s).attr("height",c).attr("x",t().state.padding).attr("y",t().state.padding)},"drawForkJoinState"),j=f((e,a,s,c)=>{let n=0;const l=c.append("text");l.style("text-anchor","start"),l.attr("class","noteText");let x=e.replace(/\r\n/g,"<br/>");x=x.replace(/\n/g,"<br/>");const i=x.split(z.lineBreakRegex);let d=1.25*t().state.noteMargin;for(const w of i){const p=w.trim();if(p.length>0){const o=l.append("tspan");if(o.text(p),d===0){const g=o.node().getBBox();d+=g.height}n+=d,o.attr("x",a+t().state.noteMargin),o.attr("y",s+n+1.25*t().state.noteMargin)}}return{textWidth:l.node().getBBox().width,textHeight:n}},"_drawLongText"),K=f((e,a)=>{a.attr("class","state-note");const s=a.append("rect").attr("x",0).attr("y",t().state.padding),c=a.append("g"),{textWidth:n,textHeight:l}=j(e,0,0,c);return s.attr("height",l+2*t().state.noteMargin),s.attr("width",n+t().state.noteMargin*2),s},"drawNote"),L=f(function(e,a){const s=a.id,c={id:s,label:a.id,width:0,height:0},n=e.append("g").attr("id",s).attr("class","stateGroup");a.type==="start"&&O(n),a.type==="end"&&q(n),(a.type==="fork"||a.type==="join")&&Z(n,a),a.type==="note"&&K(a.note.text,n),a.type==="divider"&&J(n),a.type==="default"&&a.descriptions.length===0&&X(n,a),a.type==="default"&&a.descriptions.length>0&&Y(n,a);const l=n.node().getBBox();return c.width=l.width+2*t().state.padding,c.height=l.height+2*t().state.padding,c},"drawState"),_=0,Q=f(function(e,a,s){const c=f(function(d){switch(d){case N.relationType.AGGREGATION:return"aggregation";case N.relationType.EXTENSION:return"extension";case N.relationType.COMPOSITION:return"composition";case N.relationType.DEPENDENCY:return"dependency"}},"getRelationType");a.points=a.points.filter(d=>!Number.isNaN(d.y));const n=a.points,l=W().x(function(d){return d.x}).y(function(d){return d.y}).curve(U),x=e.append("path").attr("d",l(n)).attr("id","edge"+_).attr("class","transition");let i="";if(t().state.arrowMarkerAbsolute&&(i=C(!0)),x.attr("marker-end","url("+i+"#"+c(N.relationType.DEPENDENCY)+"End)"),s.title!==void 0){const d=e.append("g").attr("class","stateLabel"),{x:w,y:p}=D.calcLabelPosition(a.points),o=z.getRows(s.title);let g=0;const b=[];let m=0,v=0;for(let u=0;u<=o.length;u++){const h=d.append("text").attr("text-anchor","middle").text(o[u]).attr("x",w).attr("y",p+g),y=h.node().getBBox();m=Math.max(m,y.width),v=Math.min(v,y.x),S.info(y.x,w,p+g),g===0&&(g=h.node().getBBox().height,S.info("Title height",g,p)),b.push(h)}let k=g*o.length;if(o.length>1){const u=(o.length-1)*g*.5;b.forEach((h,y)=>h.attr("y",p+y*g-u)),k=g*o.length}const r=d.node().getBBox();d.insert("rect",":first-child").attr("class","box").attr("x",w-m/2-t().state.padding/2).attr("y",p-k/2-t().state.padding/2-3.5).attr("width",m+t().state.padding).attr("height",k+t().state.padding),S.info(r)}_++},"drawEdge"),B,H={},V=f(function(){},"setConf"),tt=f(function(e){e.append("defs").append("marker").attr("id","dependencyEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 19,7 L9,13 L14,7 L9,1 Z")},"insertMarkers"),et=f(function(e,a,s,c){B=t().state;const n=t().securityLevel;let l;n==="sandbox"&&(l=M("#i"+a));const x=n==="sandbox"?M(l.nodes()[0].contentDocument.body):M("body"),i=n==="sandbox"?l.nodes()[0].contentDocument:document;S.debug("Rendering diagram "+e);const d=x.select(`[id='${a}']`);tt(d);const w=c.db.getRootDoc();R(w,d,void 0,!1,x,i,c);const p=B.padding,o=d.node().getBBox(),g=o.width+p*2,b=o.height+p*2,m=g*1.75;P(d,b,m,B.useMaxWidth),d.attr("viewBox",`${o.x-B.padding}  ${o.y-B.padding} `+g+" "+b)},"draw"),at=f(e=>e?e.length*B.fontSizeFactor:1,"getLabelWidth"),R=f((e,a,s,c,n,l,x)=>{const i=new F({compound:!0,multigraph:!0});let d,w=!0;for(d=0;d<e.length;d++)if(e[d].stmt==="relation"){w=!1;break}s?i.setGraph({rankdir:"LR",multigraph:!0,compound:!0,ranker:"tight-tree",ranksep:w?1:B.edgeLengthFactor,nodeSep:w?1:50,isMultiGraph:!0}):i.setGraph({rankdir:"TB",multigraph:!0,compound:!0,ranksep:w?1:B.edgeLengthFactor,nodeSep:w?1:50,ranker:"tight-tree",isMultiGraph:!0}),i.setDefaultEdgeLabel(function(){return{}});const p=x.db.getStates(),o=x.db.getRelations(),g=Object.keys(p);for(const r of g){const u=p[r];s&&(u.parentId=s);let h;if(u.doc){let y=a.append("g").attr("id",u.id).attr("class","stateGroup");h=R(u.doc,y,u.id,!c,n,l,x);{y=$(y,u,c);let E=y.node().getBBox();h.width=E.width,h.height=E.height+B.padding/2,H[u.id]={y:B.compositTitleSize}}}else h=L(a,u,i);if(u.note){const y={descriptions:[],id:u.id+"-note",note:u.note,type:"note"},E=L(a,y,i);u.note.position==="left of"?(i.setNode(h.id+"-note",E),i.setNode(h.id,h)):(i.setNode(h.id,h),i.setNode(h.id+"-note",E)),i.setParent(h.id,h.id+"-group"),i.setParent(h.id+"-note",h.id+"-group")}else i.setNode(h.id,h)}S.debug("Count=",i.nodeCount(),i);let b=0;o.forEach(function(r){b++,S.debug("Setting edge",r),i.setEdge(r.id1,r.id2,{relation:r,width:at(r.title),height:B.labelHeight*z.getRows(r.title).length,labelpos:"c"},"id"+b)}),I(i),S.debug("Graph after layout",i.nodes());const m=a.node();i.nodes().forEach(function(r){r!==void 0&&i.node(r)!==void 0?(S.warn("Node "+r+": "+JSON.stringify(i.node(r))),n.select("#"+m.id+" #"+r).attr("transform","translate("+(i.node(r).x-i.node(r).width/2)+","+(i.node(r).y+(H[r]?H[r].y:0)-i.node(r).height/2)+" )"),n.select("#"+m.id+" #"+r).attr("data-x-shift",i.node(r).x-i.node(r).width/2),l.querySelectorAll("#"+m.id+" #"+r+" .divider").forEach(h=>{const y=h.parentElement;let E=0,T=0;y&&(y.parentElement&&(E=y.parentElement.getBBox().width),T=parseInt(y.getAttribute("data-x-shift"),10),Number.isNaN(T)&&(T=0)),h.setAttribute("x1",0-T+8),h.setAttribute("x2",E-T-8)})):S.debug("No Node "+r+": "+JSON.stringify(i.node(r)))});let v=m.getBBox();i.edges().forEach(function(r){r!==void 0&&i.edge(r)!==void 0&&(S.debug("Edge "+r.v+" -> "+r.w+": "+JSON.stringify(i.edge(r))),Q(a,i.edge(r),i.edge(r).relation))}),v=m.getBBox();const k={id:s||"root",label:s||"root",width:0,height:0};return k.width=v.width+2*B.padding,k.height=v.height+2*B.padding,S.debug("Doc rendered",k,i),k},"renderDoc"),it={setConf:V,draw:et},ut={parser:G,get db(){return new N(1)},renderer:it,styles:A,init:f(e=>{e.state||(e.state={}),e.state.arrowMarkerAbsolute=e.arrowMarkerAbsolute},"init")};export{ut as diagram};
