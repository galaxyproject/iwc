{
    "name": "Velocyto-on10X-from-bundled",
    "subclass": "Galaxy",
    "publish": true,
    "primaryDescriptorPath": "/Velocyto-on10X-from-bundled.ga",
    "testParameterFiles": [
        "/Velocyto-on10X-from-bundled-tests.yml"
    ],
    "authors": [
        {
            "name": "Lucille Delisle",
            "orcid": "0000-0002-1964-4960"
        }
    ],
    "definition": {
        "a_galaxy_workflow": "true",
        "annotation": "Processes 10X Genomics single-cell RNA-seq data using Velocyto to quantify spliced and unspliced transcript counts for RNA velocity analysis. Automatically extracts cell barcodes from standard 10X bundled output and generates a loom file containing separate counts for spliced exons, unspliced introns, and ambiguous regions. Enables downstream trajectory inference and cellular dynamics analysis.",
        "comments": [],
        "creator": [
            {
                "class": "Person",
                "identifier": "https://orcid.org/0000-0002-1964-4960",
                "name": "Lucille Delisle"
            }
        ],
        "format-version": "0.1",
        "license": "MIT",
        "release": "0.2",
        "name": "RNA Velocity Analysis: Velocyto for 10X Data from Bundled Output",
        "steps": {
            "0": {
                "annotation": "This can be output of CellRanger or STARsolo",
                "content_id": null,
                "errors": null,
                "id": 0,
                "input_connections": {},
                "inputs": [
                    {
                        "description": "This can be output of CellRanger or STARsolo",
                        "name": "BAM files with CB and UB"
                    }
                ],
                "label": "BAM files with CB and UB",
                "name": "Input dataset collection",
                "outputs": [],
                "position": {
                    "left": 0,
                    "top": 0
                },
                "tool_id": null,
                "tool_state": "{\"optional\": false, \"format\": [\"bam\"], \"tag\": \"\", \"collection_type\": \"list\"}",
                "tool_version": null,
                "type": "data_collection_input",
                "uuid": "043d198b-3af0-477d-be11-5d1373280379",
                "when": null,
                "workflow_outputs": []
            },
            "1": {
                "annotation": "This can be output of STARsolo or DropletUtils",
                "content_id": null,
                "errors": null,
                "id": 1,
                "input_connections": {},
                "inputs": [
                    {
                        "description": "This can be output of STARsolo or DropletUtils",
                        "name": "filtered matrices in bundle"
                    }
                ],
                "label": "filtered matrices in bundle",
                "name": "Input dataset collection",
                "outputs": [],
                "position": {
                    "left": 141,
                    "top": 139
                },
                "tool_id": null,
                "tool_state": "{\"optional\": false, \"tag\": \"\", \"collection_type\": \"list\"}",
                "tool_version": null,
                "type": "data_collection_input",
                "uuid": "03b0d22c-3b46-4460-8c18-b524bc09d655",
                "when": null,
                "workflow_outputs": []
            },
            "2": {
                "annotation": "gtf file",
                "content_id": null,
                "errors": null,
                "id": 2,
                "input_connections": {},
                "inputs": [
                    {
                        "description": "gtf file",
                        "name": "gtf file"
                    }
                ],
                "label": "gtf file",
                "name": "Input dataset",
                "outputs": [],
                "position": {
                    "left": 231,
                    "top": 273
                },
                "tool_id": null,
                "tool_state": "{\"optional\": false, \"format\": [\"gtf\"], \"tag\": \"\"}",
                "tool_version": null,
                "type": "data_input",
                "uuid": "f1d04259-f449-44d7-8d36-49f3ad664361",
                "when": null,
                "workflow_outputs": []
            },
            "3": {
                "annotation": "",
                "content_id": "__APPLY_RULES__",
                "errors": null,
                "id": 3,
                "input_connections": {
                    "input": {
                        "id": 1,
                        "output_name": "output"
                    }
                },
                "inputs": [
                    {
                        "description": "runtime parameter for tool Apply rules",
                        "name": "input"
                    }
                ],
                "label": "extract barcodes from bundle",
                "name": "Apply rules",
                "outputs": [
                    {
                        "name": "output",
                        "type": "input"
                    }
                ],
                "position": {
                    "left": 421,
                    "top": 133
                },
                "post_job_actions": {
                    "HideDatasetActionoutput": {
                        "action_arguments": {},
                        "action_type": "HideDatasetAction",
                        "output_name": "output"
                    }
                },
                "tool_id": "__APPLY_RULES__",
                "tool_state": "{\"input\": {\"__class__\": \"ConnectedValue\"}, \"rules\": {\"mapping\": [{\"columns\": [0], \"editing\": false, \"type\": \"list_identifiers\"}], \"rules\": [{\"error\": null, \"type\": \"add_column_metadata\", \"value\": \"identifier0\", \"warn\": null}, {\"error\": null, \"type\": \"add_column_metadata\", \"value\": \"identifier1\", \"warn\": null}, {\"error\": null, \"invert\": false, \"target_column\": 1, \"type\": \"add_filter_matches\", \"value\": \"barcodes\", \"warn\": null}]}, \"__page__\": null, \"__rerun_remap_job_id__\": null}",
                "tool_version": "1.1.0",
                "type": "tool",
                "uuid": "8c2d032f-596c-4315-8361-ebf1ec2eb655",
                "when": null,
                "workflow_outputs": []
            },
            "4": {
                "annotation": "",
                "id": 4,
                "input_connections": {
                    "BAM files with CB and UB": {
                        "id": 0,
                        "input_subworkflow_step_id": 0,
                        "output_name": "output"
                    },
                    "filtered barcodes": {
                        "id": 3,
                        "input_subworkflow_step_id": 1,
                        "output_name": "output"
                    },
                    "gtf file": {
                        "id": 2,
                        "input_subworkflow_step_id": 2,
                        "output_name": "output"
                    }
                },
                "inputs": [],
                "label": null,
                "name": "Velocyto_on10X_filtered_barcodes",
                "outputs": [],
                "position": {
                    "left": 710,
                    "top": 63.5
                },
                "subworkflow": {
                    "a_galaxy_workflow": "true",
                    "annotation": "",
                    "comments": [],
                    "creator": [
                        {
                            "class": "Person",
                            "identifier": "https://orcid.org/0000-0002-1964-4960",
                            "name": "Lucille Delisle"
                        }
                    ],
                    "format-version": "0.1",
                    "license": "MIT",
                    "name": "Velocyto_on10X_filtered_barcodes",
                    "steps": {
                        "0": {
                            "annotation": "This can be output of CellRanger or STARsolo",
                            "content_id": null,
                            "errors": null,
                            "id": 0,
                            "input_connections": {},
                            "inputs": [
                                {
                                    "description": "This can be output of CellRanger or STARsolo",
                                    "name": "BAM files with CB and UB"
                                }
                            ],
                            "label": "BAM files with CB and UB",
                            "name": "Input dataset collection",
                            "outputs": [],
                            "position": {
                                "left": 0.0,
                                "top": 0.0
                            },
                            "tool_id": null,
                            "tool_state": "{\"optional\": false, \"format\": [\"bam\"], \"tag\": \"\", \"collection_type\": \"list\"}",
                            "tool_version": null,
                            "type": "data_collection_input",
                            "uuid": "043d198b-3af0-477d-be11-5d1373280379",
                            "when": null,
                            "workflow_outputs": []
                        },
                        "1": {
                            "annotation": "This can be output of STARsolo or DropletUtils",
                            "content_id": null,
                            "errors": null,
                            "id": 1,
                            "input_connections": {},
                            "inputs": [
                                {
                                    "description": "This can be output of STARsolo or DropletUtils",
                                    "name": "filtered barcodes"
                                }
                            ],
                            "label": "filtered barcodes",
                            "name": "Input dataset collection",
                            "outputs": [],
                            "position": {
                                "left": 55.999999999999986,
                                "top": 108.33333333333333
                            },
                            "tool_id": null,
                            "tool_state": "{\"optional\": false, \"format\": [\"tsv\"], \"tag\": \"\", \"collection_type\": \"list\"}",
                            "tool_version": null,
                            "type": "data_collection_input",
                            "uuid": "03b0d22c-3b46-4460-8c18-b524bc09d655",
                            "when": null,
                            "workflow_outputs": []
                        },
                        "2": {
                            "annotation": "gtf file",
                            "content_id": null,
                            "errors": null,
                            "id": 2,
                            "input_connections": {},
                            "inputs": [
                                {
                                    "description": "gtf file",
                                    "name": "gtf file"
                                }
                            ],
                            "label": "gtf file",
                            "name": "Input dataset",
                            "outputs": [],
                            "position": {
                                "left": 148.0,
                                "top": 204.66666666666666
                            },
                            "tool_id": null,
                            "tool_state": "{\"optional\": false, \"format\": [\"gtf\"], \"tag\": \"\"}",
                            "tool_version": null,
                            "type": "data_input",
                            "uuid": "f1d04259-f449-44d7-8d36-49f3ad664361",
                            "when": null,
                            "workflow_outputs": []
                        },
                        "3": {
                            "annotation": "",
                            "content_id": "toolshed.g2.bx.psu.edu/repos/iuc/velocyto_cli/velocyto_cli/0.17.17+galaxy2",
                            "errors": null,
                            "id": 3,
                            "input_connections": {
                                "main|BAM": {
                                    "id": 0,
                                    "output_name": "output"
                                },
                                "main|barcodes": {
                                    "id": 1,
                                    "output_name": "output"
                                },
                                "main|gtffile": {
                                    "id": 2,
                                    "output_name": "output"
                                }
                            },
                            "inputs": [
                                {
                                    "description": "runtime parameter for tool velocyto CLI",
                                    "name": "main"
                                },
                                {
                                    "description": "runtime parameter for tool velocyto CLI",
                                    "name": "main"
                                },
                                {
                                    "description": "runtime parameter for tool velocyto CLI",
                                    "name": "main"
                                },
                                {
                                    "description": "runtime parameter for tool velocyto CLI",
                                    "name": "main"
                                },
                                {
                                    "description": "runtime parameter for tool velocyto CLI",
                                    "name": "main"
                                }
                            ],
                            "label": "velocyto",
                            "name": "velocyto CLI",
                            "outputs": [
                                {
                                    "name": "samples",
                                    "type": "loom"
                                }
                            ],
                            "position": {
                                "left": 470.66666666666663,
                                "top": 116.32222493489576
                            },
                            "post_job_actions": {},
                            "tool_id": "toolshed.g2.bx.psu.edu/repos/iuc/velocyto_cli/velocyto_cli/0.17.17+galaxy2",
                            "tool_shed_repository": {
                                "changeset_revision": "90e95e9ee190",
                                "name": "velocyto_cli",
                                "owner": "iuc",
                                "tool_shed": "toolshed.g2.bx.psu.edu"
                            },
                            "tool_state": "{\"main\": {\"do\": \"run10x\", \"__current_case__\": 0, \"sample_definition\": {\"sample_definition_select\": \"identifier\", \"__current_case__\": 1}, \"BAM\": {\"__class__\": \"ConnectedValue\"}, \"barcodes\": {\"__class__\": \"ConnectedValue\"}, \"gtffile\": {\"__class__\": \"ConnectedValue\"}, \"s\": {\"__class__\": \"RuntimeValue\"}, \"m\": {\"__class__\": \"RuntimeValue\"}, \"M\": false, \"t\": \"uint16\"}, \"verbosity\": \"-vv\", \"__page__\": null, \"__rerun_remap_job_id__\": null}",
                            "tool_version": "0.17.17+galaxy2",
                            "type": "tool",
                            "uuid": "f9aef50f-b31d-44dd-aad6-fe4d520e3b1e",
                            "when": null,
                            "workflow_outputs": [
                                {
                                    "label": "velocyto loom",
                                    "output_name": "samples",
                                    "uuid": "2899a85c-c198-436f-a409-9bfbdf90c95f"
                                }
                            ]
                        }
                    },
                    "tags": "",
                    "uuid": "66e3b8eb-d312-488e-b407-1ed3fa627ebb"
                },
                "tool_id": null,
                "type": "subworkflow",
                "uuid": "39ea418d-135d-4e7d-b2fe-fbde5c7393b7",
                "when": null,
                "workflow_outputs": [
                    {
                        "label": "velocyto loom",
                        "output_name": "velocyto loom",
                        "uuid": "865e6dd6-8c01-4188-a1f6-4cd77e433eed"
                    }
                ]
            }
        },
        "tags": [
            "name:single-cell"
        ],
        "uuid": "0608c7f4-767c-47b3-ae45-4e98c7c83bec",
        "version": 8
    },
    "workflow_job_input": {
        "BAM files with CB and UB": {
            "class": "Collection",
            "collection_type": "list",
            "elements": [
                {
                    "class": "File",
                    "identifier": "todo_element_name",
                    "path": "todo_test_data_path.ext"
                }
            ]
        },
        "filtered matrices in bundle": {
            "class": "Collection",
            "collection_type": "list",
            "elements": [
                {
                    "class": "File",
                    "identifier": "todo_element_name",
                    "path": "todo_test_data_path.ext"
                }
            ]
        },
        "gtf file": {
            "class": "File",
            "path": "todo_test_data_path.ext"
        }
    },
    "readme": "# RNA Velocity Analysis: Velocyto for 10X Genomics Data\n\nThese workflows simply run velocyto. There are 2 workflows because one can be easily run after the Single-Cell RNA-seq Preprocessing: 10X Genomics v3 to Seurat-Compatible Format' workflows (RNA Velocity Analysis: Velocyto for 10X Data from Bundled Output). The other can be easily run from uploaded datasets (RNA Velocity Analysis: Velocyto for 10X Data with Filtered Barcodes).\n\n## Input datasets\n\n- BAM files with CB and UB: A collection of BAM. It accepts BAM from cellranger or STARsolo with the CB and UB tags (if you use the fastq-to-matrix-10x workflows these tags are automatically included).\n- filtered barcodes (only for Velocyto_on10X_filtered_barcodes workflow): A collection of filtered barcodes (this is what will be used by velocyto). 'Filtered' means that these barcodes have been identified as potential cells. It should not be the whole list of 3 million possible barcodes from cellranger.\n- filtered matrices in bundle (only for Velocyto_on10X_from_bundled workflow): A collection of filtered matrices as bundled (like the one which comes from the fastq-to-matrix-10x workflows): A collection with as many items as samples. For each sample, the item is a list with 3 datasets (barcodes, genes, matrix). The workflow will then extract the items which have the 'barcodes' identifier.\n- gtf file: A file with annotations where exons are and how they are grouped into genes.\n\n## Processing\n\n- If you provided matrices, the first step is to extract barcodes.\n- For both cases velocyto cli is run to get a loom file per sample with spliced and unspliced counts.\n",
    "changelog": "# Changelog\n\n## [0.2] - 2024-02-05\n\n### Automatic update\n- `toolshed.g2.bx.psu.edu/repos/iuc/velocyto_cli/velocyto_cli/0.17.17+galaxy1` was updated to `toolshed.g2.bx.psu.edu/repos/iuc/velocyto_cli/velocyto_cli/0.17.17+galaxy2`\n## [0.1] - 2024-01-26\n\nFirst release.\n",
    "diagrams": "# Workflow diagrams\n\n## RNA Velocity Analysis: Velocyto for 10X Data from Bundled Output\n\n```mermaid\ngraph LR\n0[\"\u2139\ufe0f BAM files with CB and UB\"]@{ shape: docs }\n1[\"\u2139\ufe0f filtered matrices in bundle\"]@{ shape: docs }\n2[\"\u2139\ufe0f gtf file\"]@{ shape: doc }\n3[\"extract barcodes from bundle\"]@{ shape: process }\n1 --> 3\n4[\"\ud83d\udee0\ufe0f Velocyto_on10X_filtered_barcodes\"]@{ shape: subprocess }\n0 --> 4\n3 --> 4\n2 --> 4\n```\n\n## Velocyto_on10X_filtered_barcodes\n\n```mermaid\ngraph LR\n0[\"\u2139\ufe0f BAM files with CB and UB\"]@{ shape: docs }\n1[\"\u2139\ufe0f filtered barcodes\"]@{ shape: docs }\n2[\"\u2139\ufe0f gtf file\"]@{ shape: doc }\n3[\"velocyto\"]@{ shape: process }\n0 --> 3\n1 --> 3\n2 --> 3\n```\n",
    "updated": "2024-02-05T00:00:00",
    "trsID": "#workflow/github.com/iwc-workflows/velocyto/Velocyto-on10X-from-bundled",
    "iwcID": "velocyto-velocyto-on10x-from-bundled",
    "dockstore_id": 25201,
    "categories": [],
    "collections": [
        "Single Cell"
    ],
    "doi": "10.5281/zenodo.15078509",
    "tests": [
        {
            "doc": "Test outline for Velocyto-on10X (bundled)",
            "job": {
                "gtf file": {
                    "class": "File",
                    "location": "https://zenodo.org/record/6457007/files/Drosophila_melanogaster.BDGP6.32.109_UCSC.gtf.gz",
                    "decompress": true,
                    "filetype": "gtf"
                },
                "BAM files with CB and UB": {
                    "class": "Collection",
                    "collection_type": "list",
                    "elements": [
                        {
                            "class": "File",
                            "identifier": "subsample",
                            "location": "https://zenodo.org/records/10572348/files/subsample.bam",
                            "filetype": "bam"
                        }
                    ]
                },
                "filtered matrices in bundle": {
                    "class": "Collection",
                    "collection_type": "list:list",
                    "elements": [
                        {
                            "class": "Collection",
                            "type": "list",
                            "identifier": "subsample",
                            "elements": [
                                {
                                    "class": "File",
                                    "identifier": "barcodes",
                                    "location": "https://zenodo.org/records/10572348/files/barcodes.tsv",
                                    "filetype": "tsv"
                                },
                                {
                                    "class": "File",
                                    "identifier": "genes",
                                    "location": "https://zenodo.org/records/10572348/files/genes.tsv",
                                    "filetype": "tsv"
                                },
                                {
                                    "class": "File",
                                    "identifier": "matrix",
                                    "location": "https://zenodo.org/records/10572348/files/matrix.mtx",
                                    "filetype": "mtx"
                                }
                            ]
                        }
                    ]
                }
            },
            "outputs": {
                "velocyto loom": {
                    "element_tests": {
                        "subsample": {
                            "asserts": {
                                "has_size": {
                                    "value": 4639326,
                                    "delta": 400000
                                }
                            }
                        }
                    }
                }
            }
        }
    ]
}