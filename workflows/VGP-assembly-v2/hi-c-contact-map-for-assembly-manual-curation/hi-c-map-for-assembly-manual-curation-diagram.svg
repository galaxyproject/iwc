<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 680" role="img" aria-label="PretextMap generation for assembly manual curation workflow diagram">
  <title>Hi-C Contact Map for Assembly Manual Curation</title>
  <desc>VGP workflow to generate PretextMap contact maps from 1 or 2 haplotypes with Hi-C and PacBio reads for manual curation, including coverage tracks, telomere detection, and gap annotation</desc>

  <defs>
    <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
      <path d="M 20 0 L 0 0 0 20" fill="none" stroke="#c5d5e4" stroke-width="0.5"/>
    </pattern>
    <pattern id="grid-major" width="100" height="100" patternUnits="userSpaceOnUse">
      <rect width="100" height="100" fill="url(#grid)"/>
      <path d="M 100 0 L 0 0 0 100" fill="none" stroke="#b0c4d8" stroke-width="1"/>
    </pattern>
    <pattern id="subworkflow-stripe" width="8" height="8" patternUnits="userSpaceOnUse" patternTransform="rotate(45)">
      <line x1="0" y1="0" x2="0" y2="8" stroke="#e9ecef" stroke-width="4"/>
    </pattern>
    <style>
      .connection { stroke: #25537b; stroke-width: 4; fill: none; stroke-linecap: round; }
      .connection-secondary { stroke: #25537b; stroke-width: 3; fill: none; stroke-linecap: round; }
      .connection-qc { stroke: #25537b; stroke-width: 3; fill: none; stroke-linecap: round; stroke-dasharray: 5 3; }
      .node-card { filter: drop-shadow(1px 2px 3px rgba(0,0,0,0.15)); }
    </style>
  </defs>

  <rect width="1200" height="680" fill="#f8f9fa"/>
  <rect width="1200" height="680" fill="url(#grid-major)"/>

  <rect x="0" y="0" width="1200" height="45" fill="#25537b"/>
  <text x="20" y="28" font-family="system-ui, sans-serif" font-size="16" font-weight="600" fill="white">Hi-C Contact Map for Assembly Manual Curation</text>
  <text x="1180" y="28" text-anchor="end" font-family="system-ui, sans-serif" font-size="11" fill="rgba(255,255,255,0.7)">VGP Assembly Pipeline</text>

  <!-- CONNECTIONS -->

  <!-- Hap1 to Haplotype Merge -->
  <path class="connection" d="M 200 120 C 260 120, 290 135, 330 135"/>

  <!-- Hap2 to Haplotype Merge -->
  <path class="connection" d="M 200 220 C 260 220, 290 155, 330 155"/>

  <!-- Hi-C reads to Hi-C Alignment -->
  <path class="connection" d="M 200 340 C 350 340, 540 270, 580 270"/>

  <!-- PacBio reads to minimap2 -->
  <path class="connection" d="M 200 440 C 350 440, 540 400, 580 400"/>

  <!-- Haplotype Merge to Hi-C Alignment -->
  <path class="connection" d="M 530 145 C 560 145, 560 255, 580 255"/>

  <!-- Haplotype Merge to Telomere Detection -->
  <path class="connection" d="M 530 155 C 555 155, 555 145, 580 145"/>

  <!-- Haplotype Merge to minimap2 -->
  <path class="connection" d="M 530 160 C 555 160, 555 390, 580 390"/>

  <!-- Hi-C Alignment to PretextMap -->
  <path class="connection" d="M 780 265 C 830 265, 840 175, 870 175"/>

  <!-- Telomere to PretextGraph -->
  <path class="connection-qc" d="M 780 145 C 830 145, 840 195, 870 195"/>

  <!-- minimap2 to Coverage Track -->
  <path class="connection" d="M 780 395 C 830 395, 840 395, 870 395"/>

  <!-- Coverage to PretextGraph -->
  <path class="connection-qc" d="M 1070 395 C 1090 395, 1090 210, 870 210"/>

  <!-- PretextMap to PretextSnapshot -->
  <path class="connection" d="M 1070 180 C 1100 180, 1100 115, 1120 115"/>

  <!-- PretextMap to Pretext output -->
  <path class="connection" d="M 1070 195 C 1100 195, 1100 205, 1120 205"/>

  <!-- Haplotype Merge to Assembly output -->
  <path class="connection" d="M 530 165 C 800 165, 1080 300, 1120 300"/>

  <!-- Coverage to Hi-C Alignments output -->
  <path class="connection" d="M 780 280 C 900 280, 1080 380, 1120 380"/>

  <!-- INPUT NODES -->

  <!-- Haplotype 1 -->
  <g class="node-card" transform="translate(20, 80)">
    <rect width="180" height="80" rx="4" fill="white" stroke="#ffd700" stroke-width="1.5"/>
    <rect width="180" height="28" rx="4" fill="#ffd700"/>
    <rect x="0" y="24" width="180" height="4" fill="#ffd700"/>
    <text x="10" y="19" font-family="system-ui, sans-serif" font-size="11" fill="rgba(44,49,67,0.6)">1:</text>
    <text x="26" y="19" font-family="system-ui, sans-serif" font-size="11" font-weight="600" fill="#2C3143">Haplotype 1</text>
    <text x="90" y="55" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#495057">Primary/hap1 assembly</text>
    <text x="90" y="72" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#868e96">FASTA format</text>
    <circle cx="180" cy="40" r="6" fill="white" stroke="#ffd700" stroke-width="2"/>
  </g>

  <!-- Haplotype 2 -->
  <g class="node-card" transform="translate(20, 185)">
    <rect width="180" height="80" rx="4" fill="white" stroke="#ffd700" stroke-width="1.5"/>
    <rect width="180" height="28" rx="4" fill="#ffd700"/>
    <rect x="0" y="24" width="180" height="4" fill="#ffd700"/>
    <text x="10" y="19" font-family="system-ui, sans-serif" font-size="11" fill="rgba(44,49,67,0.6)">2:</text>
    <text x="26" y="19" font-family="system-ui, sans-serif" font-size="11" font-weight="600" fill="#2C3143">Haplotype 2</text>
    <text x="90" y="55" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#495057">Alternate/hap2 assembly</text>
    <text x="90" y="72" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#868e96">Optional (1 or 2 haps)</text>
    <circle cx="180" cy="40" r="6" fill="white" stroke="#ffd700" stroke-width="2"/>
  </g>

  <!-- Hi-C reads -->
  <g class="node-card" transform="translate(20, 300)">
    <rect width="180" height="80" rx="4" fill="white" stroke="#ffd700" stroke-width="1.5"/>
    <rect width="180" height="28" rx="4" fill="#ffd700"/>
    <rect x="0" y="24" width="180" height="4" fill="#ffd700"/>
    <text x="10" y="19" font-family="system-ui, sans-serif" font-size="11" fill="rgba(44,49,67,0.6)">3:</text>
    <text x="26" y="19" font-family="system-ui, sans-serif" font-size="11" font-weight="600" fill="#2C3143">Hi-C Reads</text>
    <text x="90" y="55" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#495057">Proximity ligation</text>
    <text x="90" y="72" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#868e96">Paired-end reads</text>
    <circle cx="180" cy="40" r="6" fill="white" stroke="#ffd700" stroke-width="2"/>
  </g>

  <!-- PacBio reads -->
  <g class="node-card" transform="translate(20, 400)">
    <rect width="180" height="80" rx="4" fill="white" stroke="#ffd700" stroke-width="1.5"/>
    <rect width="180" height="28" rx="4" fill="#ffd700"/>
    <rect x="0" y="24" width="180" height="4" fill="#ffd700"/>
    <text x="10" y="19" font-family="system-ui, sans-serif" font-size="11" fill="rgba(44,49,67,0.6)">4:</text>
    <text x="26" y="19" font-family="system-ui, sans-serif" font-size="11" font-weight="600" fill="#2C3143">PacBio Reads</text>
    <text x="90" y="55" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#495057">Long reads for coverage</text>
    <text x="90" y="72" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#868e96">HiFi reads</text>
    <circle cx="180" cy="40" r="6" fill="white" stroke="#ffd700" stroke-width="2"/>
  </g>

  <!-- PROCESSING NODES -->

  <!-- Haplotype Merge/Suffix subworkflow -->
  <g class="node-card" transform="translate(330, 95)">
    <rect width="200" height="100" rx="6" fill="url(#subworkflow-stripe)" stroke="#25537b" stroke-width="2"/>
    <rect width="200" height="100" rx="6" fill="rgba(255,255,255,0.92)" stroke="#25537b" stroke-width="2"/>
    <rect width="200" height="28" rx="6" fill="#25537b"/>
    <rect x="0" y="24" width="200" height="4" fill="#25537b"/>
    <text x="10" y="19" font-family="system-ui, sans-serif" font-size="11" fill="rgba(255,255,255,0.7)">A:</text>
    <text x="26" y="19" font-family="system-ui, sans-serif" font-size="11" font-weight="600" fill="white">Haplotype Preparation</text>
    <text x="100" y="50" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#495057">Add haplotype suffixes</text>
    <text x="100" y="65" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#495057">Concatenate assemblies</text>
    <text x="100" y="82" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#868e96">1 or 2 haplotype modes</text>
    <circle cx="0" cy="40" r="6" fill="white" stroke="#25537b" stroke-width="2"/>
    <circle cx="0" cy="60" r="6" fill="white" stroke="#25537b" stroke-width="2"/>
    <circle cx="200" cy="50" r="6" fill="white" stroke="#25537b" stroke-width="2"/>
    <circle cx="200" cy="60" r="6" fill="white" stroke="#25537b" stroke-width="2"/>
    <circle cx="200" cy="70" r="6" fill="white" stroke="#25537b" stroke-width="2"/>
  </g>

  <!-- Telomere Detection -->
  <g class="node-card" transform="translate(580, 105)">
    <rect width="200" height="80" rx="4" fill="white" stroke="#25537b" stroke-width="1"/>
    <rect width="200" height="28" rx="4" fill="#25537b"/>
    <rect x="0" y="24" width="200" height="4" fill="#25537b"/>
    <text x="10" y="19" font-family="system-ui, sans-serif" font-size="11" fill="rgba(255,255,255,0.7)">B:</text>
    <text x="26" y="19" font-family="system-ui, sans-serif" font-size="11" font-weight="600" fill="white">seqtk telo</text>
    <text x="100" y="55" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#495057">Telomere detection</text>
    <text x="100" y="72" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#868e96">Chromosome ends</text>
    <circle cx="0" cy="40" r="6" fill="white" stroke="#25537b" stroke-width="2"/>
    <circle cx="200" cy="40" r="6" fill="white" stroke="#25537b" stroke-width="2"/>
  </g>

  <!-- Hi-C Alignment subworkflow -->
  <g class="node-card" transform="translate(580, 220)">
    <rect width="200" height="110" rx="6" fill="url(#subworkflow-stripe)" stroke="#25537b" stroke-width="2"/>
    <rect width="200" height="110" rx="6" fill="rgba(255,255,255,0.92)" stroke="#25537b" stroke-width="2"/>
    <rect width="200" height="28" rx="6" fill="#25537b"/>
    <rect x="0" y="24" width="200" height="4" fill="#25537b"/>
    <text x="10" y="19" font-family="system-ui, sans-serif" font-size="11" fill="rgba(255,255,255,0.7)">C:</text>
    <text x="26" y="19" font-family="system-ui, sans-serif" font-size="11" font-weight="600" fill="white">Hi-C Alignment</text>
    <text x="100" y="50" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#495057">Trim &amp; align Hi-C pairs</text>
    <text x="100" y="65" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#495057">bwa-mem2 mapping</text>
    <text x="100" y="82" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#868e96">Merge alignments</text>
    <circle cx="0" cy="35" r="6" fill="white" stroke="#25537b" stroke-width="2"/>
    <circle cx="0" cy="50" r="6" fill="white" stroke="#25537b" stroke-width="2"/>
    <circle cx="200" cy="45" r="6" fill="white" stroke="#25537b" stroke-width="2"/>
    <circle cx="200" cy="60" r="6" fill="white" stroke="#25537b" stroke-width="2"/>
  </g>

  <!-- minimap2 for PacBio coverage -->
  <g class="node-card" transform="translate(580, 355)">
    <rect width="200" height="90" rx="4" fill="white" stroke="#25537b" stroke-width="1"/>
    <rect width="200" height="28" rx="4" fill="#25537b"/>
    <rect x="0" y="24" width="200" height="4" fill="#25537b"/>
    <text x="10" y="19" font-family="system-ui, sans-serif" font-size="11" fill="rgba(255,255,255,0.7)">D:</text>
    <text x="26" y="19" font-family="system-ui, sans-serif" font-size="11" font-weight="600" fill="white">minimap2</text>
    <text x="100" y="55" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#495057">PacBio read mapping</text>
    <text x="100" y="72" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#868e96">Coverage calculation</text>
    <circle cx="0" cy="35" r="6" fill="white" stroke="#25537b" stroke-width="2"/>
    <circle cx="0" cy="50" r="6" fill="white" stroke="#25537b" stroke-width="2"/>
    <circle cx="200" cy="45" r="6" fill="white" stroke="#25537b" stroke-width="2"/>
  </g>

  <!-- PretextMap + Graph -->
  <g class="node-card" transform="translate(870, 130)">
    <rect width="200" height="120" rx="4" fill="white" stroke="#10b981" stroke-width="1.5"/>
    <rect width="200" height="28" rx="4" fill="#10b981"/>
    <rect x="0" y="24" width="200" height="4" fill="#10b981"/>
    <text x="10" y="19" font-family="system-ui, sans-serif" font-size="11" fill="rgba(255,255,255,0.7)">QC:</text>
    <text x="34" y="19" font-family="system-ui, sans-serif" font-size="11" font-weight="600" fill="white">PretextMap + Graph</text>
    <text x="100" y="50" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#495057">Hi-C contact map</text>
    <text x="100" y="65" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#495057">+ telomere track</text>
    <text x="100" y="80" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#495057">+ coverage track</text>
    <text x="100" y="97" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#868e96">+ gap annotations</text>
    <circle cx="0" cy="45" r="5" fill="white" stroke="#10b981" stroke-width="1.5"/>
    <circle cx="0" cy="65" r="5" fill="white" stroke="#10b981" stroke-width="1.5"/>
    <circle cx="0" cy="80" r="5" fill="white" stroke="#10b981" stroke-width="1.5"/>
    <circle cx="200" cy="50" r="5" fill="white" stroke="#10b981" stroke-width="1.5"/>
    <circle cx="200" cy="75" r="5" fill="white" stroke="#10b981" stroke-width="1.5"/>
  </g>

  <!-- Coverage Track -->
  <g class="node-card" transform="translate(870, 355)">
    <rect width="200" height="90" rx="4" fill="white" stroke="#25537b" stroke-width="1"/>
    <rect width="200" height="28" rx="4" fill="#25537b"/>
    <rect x="0" y="24" width="200" height="4" fill="#25537b"/>
    <text x="10" y="19" font-family="system-ui, sans-serif" font-size="11" fill="rgba(255,255,255,0.7)">E:</text>
    <text x="26" y="19" font-family="system-ui, sans-serif" font-size="11" font-weight="600" fill="white">Coverage Track</text>
    <text x="100" y="55" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#495057">deepTools bamCoverage</text>
    <text x="100" y="72" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#868e96">BED coverage track</text>
    <circle cx="0" cy="45" r="6" fill="white" stroke="#25537b" stroke-width="2"/>
    <circle cx="200" cy="45" r="6" fill="white" stroke="#25537b" stroke-width="2"/>
  </g>

  <!-- OUTPUT NODES -->

  <!-- Pretext Snapshot -->
  <g class="node-card" transform="translate(1120, 80)">
    <rect width="70" height="60" rx="4" fill="white" stroke="#f97316" stroke-width="1.5"/>
    <rect width="70" height="24" rx="4" fill="#f97316"/>
    <rect x="0" y="20" width="70" height="4" fill="#f97316"/>
    <text x="35" y="16" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" font-weight="600" fill="white">Snapshot</text>
    <text x="35" y="42" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#495057">Contact</text>
    <text x="35" y="52" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#495057">map PNG</text>
    <circle cx="0" cy="35" r="5" fill="white" stroke="#f97316" stroke-width="2"/>
  </g>

  <!-- Pretext Map files -->
  <g class="node-card" transform="translate(1120, 170)">
    <rect width="70" height="60" rx="4" fill="white" stroke="#f97316" stroke-width="1.5"/>
    <rect width="70" height="24" rx="4" fill="#f97316"/>
    <rect x="0" y="20" width="70" height="4" fill="#f97316"/>
    <text x="35" y="16" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" font-weight="600" fill="white">Pretext</text>
    <text x="35" y="42" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#495057">Map files</text>
    <text x="35" y="52" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#868e96">For curation</text>
    <circle cx="0" cy="35" r="5" fill="white" stroke="#f97316" stroke-width="2"/>
  </g>

  <!-- Assembly for curation -->
  <g class="node-card" transform="translate(1120, 270)">
    <rect width="70" height="60" rx="4" fill="white" stroke="#f97316" stroke-width="1.5"/>
    <rect width="70" height="24" rx="4" fill="#f97316"/>
    <rect x="0" y="20" width="70" height="4" fill="#f97316"/>
    <text x="35" y="16" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" font-weight="600" fill="white">Assembly</text>
    <text x="35" y="42" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#495057">For manual</text>
    <text x="35" y="52" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#495057">curation</text>
    <circle cx="0" cy="30" r="5" fill="white" stroke="#f97316" stroke-width="2"/>
  </g>

  <!-- Hi-C Alignments -->
  <g class="node-card" transform="translate(1120, 350)">
    <rect width="70" height="60" rx="4" fill="white" stroke="#f97316" stroke-width="1.5"/>
    <rect width="70" height="24" rx="4" fill="#f97316"/>
    <rect x="0" y="20" width="70" height="4" fill="#f97316"/>
    <text x="35" y="16" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" font-weight="600" fill="white">Hi-C BAM</text>
    <text x="35" y="42" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#495057">Merged</text>
    <text x="35" y="52" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#495057">alignments</text>
    <circle cx="0" cy="30" r="5" fill="white" stroke="#f97316" stroke-width="2"/>
  </g>

  <!-- Legend -->
  <g transform="translate(20, 650)">
    <text x="0" y="0" font-family="system-ui, sans-serif" font-size="10" font-weight="600" fill="#495057">Legend:</text>
    <rect x="60" y="-10" width="14" height="14" rx="2" fill="white" stroke="#ffd700" stroke-width="1.5"/>
    <text x="80" y="0" font-family="system-ui, sans-serif" font-size="9" fill="#6c757d">Input</text>
    <rect x="130" y="-10" width="14" height="14" rx="2" fill="white" stroke="#25537b" stroke-width="1.5"/>
    <text x="150" y="0" font-family="system-ui, sans-serif" font-size="9" fill="#6c757d">Processing</text>
    <line x1="230" y1="-4" x2="270" y2="-4" stroke="#25537b" stroke-width="4" stroke-linecap="round"/>
    <text x="278" y="0" font-family="system-ui, sans-serif" font-size="9" fill="#6c757d">Data flow</text>
    <line x1="350" y1="-4" x2="390" y2="-4" stroke="#25537b" stroke-width="3" stroke-linecap="round" stroke-dasharray="5 3"/>
    <text x="398" y="0" font-family="system-ui, sans-serif" font-size="9" fill="#6c757d">QC metrics</text>
    <rect x="480" y="-10" width="14" height="14" rx="2" fill="white" stroke="#10b981" stroke-width="1.5"/>
    <text x="500" y="0" font-family="system-ui, sans-serif" font-size="9" fill="#6c757d">QC/Report</text>
    <rect x="580" y="-10" width="14" height="14" rx="2" fill="white" stroke="#f97316" stroke-width="1.5"/>
    <text x="600" y="0" font-family="system-ui, sans-serif" font-size="9" fill="#6c757d">Output</text>
    <rect x="660" y="-10" width="14" height="14" rx="2" fill="url(#subworkflow-stripe)" stroke="#25537b" stroke-width="1.5"/>
    <text x="680" y="0" font-family="system-ui, sans-serif" font-size="9" fill="#6c757d">Subworkflow</text>
  </g>
</svg>