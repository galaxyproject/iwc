- doc: Test outline for ATACseq
  job:
    PE fastq input:
      class: Collection
      collection_type: list:paired
      elements:
      - class: Collection
        type: paired
        identifier: SRR891268_chr22_enriched
        elements:
        - identifier: forward
          class: File
          location: https://zenodo.org/record/3862793/files/SRR891268_chr22_enriched_R1.fastq.gz
          filetype: fastqsanger.gz
        - identifier: reverse
          class: File
          location: https://zenodo.org/record/3862793/files/SRR891268_chr22_enriched_R2.fastq.gz
          filetype: fastqsanger.gz
    Percentage of bad quality bases per read: 70    
    Reference Genome: hg19
    Effective genome size: 2700000000
    Bin size: 1000
  outputs:
    mapping stats:
      element_tests:
        SRR891268_chr22_enriched:
          asserts:
            - that: "has_text"
              text: "9407 (3.33%) aligned concordantly 0 times"
            - that: "has_text"
              text: "153749 (54.35%) aligned concordantly exactly 1 time"
            - that: "has_text"
              text: "119723 (42.32%) aligned concordantly >1 times"
    MarkDuplicates metrics:
      element_tests:
        SRR891268_chr22_enriched:
          asserts:
            has_text: 
              text: "0.02"
    BAM filtered rmDup:
      element_tests:
        SRR891268_chr22_enriched:
          asserts:
            has_size:
              value: 15810403
              delta: 1000000
    histogram of fragment length:
      element_tests:
        SRR891268_chr22_enriched:
          asserts:
            has_size:
              value: 47718
              delta: 4000
    MACS2 narrowPeak:
      element_tests:
        SRR891268_chr22_enriched:
          asserts:
            has_n_lines: 
              n: 237
    MACS2 report:
      element_tests:
        SRR891268_chr22_enriched:
          asserts:
            - that: "has_text"
              text: "# tag size is determined as 47 bps"
            - that: "has_text"
              text: "# total tags in treatment: 261890"
    Coverage from MACS2 (bigwig):
      element_tests:
        SRR891268_chr22_enriched:
          asserts:
            has_size:
              value: 2892925
              delta: 200000
    1kb around summits:
      element_tests:
        SRR891268_chr22_enriched:
          asserts:
            has_n_lines: 
              n: 220
    Nb of reads in summits +-500bp:
      element_tests:
        SRR891268_chr22_enriched:
          asserts:
            has_line: 
              line: "9522"
    bigwig_norm:
      element_tests:
        SRR891268_chr22_enriched:
          asserts:
            has_size:
              value: 1253177
              delta: 100000
    bigwig_norm2:
      element_tests:
        SRR891268_chr22_enriched:
          asserts:
            has_size:
              value: 1248419
              delta: 100000
    'MultiQC on input dataset(s): Stats':
      asserts:
        has_line:
          line: "Sample	macs2-d	macs2-peak_count	picard_mark_duplicates-PERCENT_DUPLICATION	bowtie_2_hisat2-overall_alignment_rate	fastp-pct_duplication	fastp-after_filtering_q30_rate	fastp-after_filtering_q30_bases	fastp-filtering_result_passed_filter_reads	fastp-after_filtering_gc_content	fastp-pct_surviving	fastp-pct_adapter"
        has_text_matching:
          expression: "SRR891268_chr22_enriched\t200.0\t237\t2.6[0-9]*\t98.[0-9]*\t6.4[0-9]*"
    MultiQC webpage:
          asserts:
            - that: "has_text"
              text: "<a href="#fastp" class="nav-l1">fastp</a>"
            - that: "has_text"
              text: "<td>% Aligned</td>"
