- doc: Test outline for ChIPseq_PE
  job:
    PE fastq input:
      class: Collection
      collection_type: list:paired
      elements:
      - class: Collection
        type: paired
        identifier: wt_H3K4me3
        elements:
        - identifier: forward
          class: File
          location: https://zenodo.org/record/1324070/files/wt_H3K4me3_read1.fastq.gz
          filetype: fastqsanger.gz
          hashes:
          - hash_function: SHA-1
            hash_value: 60cef994485a6bddf9e2b7efca464efc34559c12
        - identifier: reverse
          class: File
          location: https://zenodo.org/record/1324070/files/wt_H3K4me3_read2.fastq.gz
          filetype: fastqsanger.gz
          hashes:
          - hash_function: SHA-1
            hash_value: beaa36e4cfd92910672d1c2948d6a94204dc9788
    Percentage of bad quality bases per read: 70
    Reference genome: 'mm10'
    Effective genome size: 1870000000
    Normalize profile: true
  outputs:
    MultiQC webpage:
      asserts:
      - that: "has_text"
        text: "wt_H3K4me3"
      - that: "has_text"
        text: <a href="#fastp" class="nav-l1">fastp</a>
      - that: "has_text"
        text: <a href="#bowtie2" class="nav-l1">Bowtie 2 / HiSAT2</a>
    'MultiQC on input dataset(s): Stats':
      asserts:
        has_line:
          line: "Sample\tmacs2-d\tmacs2-treatment_redundant_rate\tmacs2-peak_count\tbowtie_2_hisat2-overall_alignment_rate\tfastp-pct_duplication\tfastp-after_filtering_q30_rate\tfastp-after_filtering_q30_bases\tfastp-filtering_result_passed_filter_reads\tfastp-after_filtering_gc_content\tfastp-pct_surviving\tfastp-pct_adapter"
        has_text_matching:
          expression: "wt_H3K4me3\t20[12].0\t0.0\t13\t98.[0-9]*\t0.002\t93.[0-9]*\t4.5[0-9]*\t0.095[0-9]*\t57.[0-9]*\t95.[0-9]*\t0.19[0-9]*"
    filtered BAM:
      element_tests:
        wt_H3K4me3:
          asserts:
            has_size:
              value: 5311841
              delta: 500000
    MACS2 summits:
      element_tests:
        wt_H3K4me3:
          asserts:
            has_n_lines:
              n: 13
    MACS2 peaks:
      element_tests:
        wt_H3K4me3:
          asserts:
          - that: "has_text"
            text: "# effective genome size = 1.87e+09"
          - that: "has_text_matching"
            expression: "# fragment size is determined as 20[12] bps"
          - that: "has_text"
            text: "# fragments after filtering in treatment: 42745"
    MACS2 narrowPeak:
      element_tests:
        wt_H3K4me3:
          asserts:
            has_n_lines:
              n: 13
    MACS2 report:
      element_tests:
        wt_H3K4me3:
          asserts:
          - that: "has_text"
            text: "# effective genome size = 1.87e+09"
          - that: "has_text_matching"
            expression: "# fragment size is determined as 20[12] bps"
          - that: "has_text"
            text: "# fragments after filtering in treatment: 42745"
    coverage from MACS2:
      element_tests:
        wt_H3K4me3:
          asserts:
            has_size:
              value: 568174
              delta: 50000
    mapping stats:
      element_tests:
        wt_H3K4me3:
          asserts:
          - that: "has_text"
            text: "1344 (2.82%) aligned concordantly 0 times"
          - that: "has_text"
            text: "42961 (90.29%) aligned concordantly exactly 1 time"
          - that: "has_text"
            text: "3276 (6.89%) aligned concordantly >1 times"
