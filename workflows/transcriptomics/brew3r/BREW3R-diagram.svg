<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1100 420" role="img" aria-label="BREW3R workflow diagram">
  <title>BREW3R: 3-prime UTR Extension</title>
  <desc>Extends 3-prime ends of gene annotations using BAM files and StringTie assembly. Input GTF and BAM collection are processed through StringTie transcript assembly, StringTie merge, and BREW3R.r to produce an extended GTF annotation</desc>

  <defs>
    <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
      <path d="M 20 0 L 0 0 0 20" fill="none" stroke="#c5d5e4" stroke-width="0.5"/>
    </pattern>
    <pattern id="grid-major" width="100" height="100" patternUnits="userSpaceOnUse">
      <rect width="100" height="100" fill="url(#grid)"/>
      <path d="M 100 0 L 0 0 0 100" fill="none" stroke="#b0c4d8" stroke-width="1"/>
    </pattern>
    <style>
      .connection { stroke: #25537b; stroke-width: 4; fill: none; stroke-linecap: round; }
      .connection-qc { stroke: #25537b; stroke-width: 3; fill: none; stroke-linecap: round; stroke-dasharray: 5 3; }
      .connection-secondary { stroke: #25537b; stroke-width: 3; fill: none; stroke-linecap: round; }
      .node-card { filter: drop-shadow(1px 2px 3px rgba(0,0,0,0.15)); }
    </style>
  </defs>

  <!-- Background -->
  <rect width="1100" height="420" fill="#f8f9fa"/>
  <rect width="1100" height="420" fill="url(#grid-major)"/>

  <!-- Title bar -->
  <rect x="0" y="0" width="1100" height="45" fill="#25537b"/>
  <text x="20" y="28" font-family="system-ui, sans-serif" font-size="16" font-weight="600" fill="white">BREW3R</text>
  <text x="105" y="28" font-family="system-ui, sans-serif" font-size="12" fill="rgba(255,255,255,0.7)">3' UTR Extension of Gene Annotations</text>

  <!-- ==================== CONNECTIONS ==================== -->

  <!-- BAM collection → StringTie -->
  <path class="connection" d="M 200 165 C 260 165, 270 145, 340 145"/>

  <!-- StringTie → StringTie merge -->
  <path class="connection" d="M 540 145 C 580 145, 590 145, 620 145"/>

  <!-- StringTie merge → BREW3R.r -->
  <path class="connection" d="M 820 145 C 850 145, 860 165, 890 165"/>

  <!-- Input GTF → BREW3R.r (direct) -->
  <path class="connection" d="M 200 275 C 500 275, 800 195, 890 185"/>

  <!-- BREW3R.r → Extended GTF output -->
  <path class="connection" d="M 990 210 C 990 260, 990 280, 990 310"/>

  <!-- ==================== NODES ==================== -->

  <!-- NODE: Input GTF (Input - Gold) -->
  <g class="node-card" transform="translate(20, 230)">
    <rect width="180" height="90" rx="4" fill="white" stroke="#ffd700" stroke-width="1.5"/>
    <rect width="180" height="28" rx="4" fill="#ffd700"/>
    <rect x="0" y="24" width="180" height="4" fill="#ffd700"/>
    <text x="10" y="19" font-family="system-ui, sans-serif" font-size="11" fill="rgba(44,49,67,0.6)">1:</text>
    <text x="26" y="19" font-family="system-ui, sans-serif" font-size="11" font-weight="600" fill="#2C3143">Input GTF</text>
    <text x="90" y="55" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#495057">Gene annotation</text>
    <text x="90" y="72" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#868e96">Reference GTF to extend</text>
    <circle cx="180" cy="45" r="6" fill="white" stroke="#ffd700" stroke-width="2"/>
  </g>

  <!-- NODE: BAM Collection (Input - Gold) -->
  <g class="node-card" transform="translate(20, 120)">
    <rect width="180" height="90" rx="4" fill="white" stroke="#ffd700" stroke-width="1.5"/>
    <rect width="180" height="28" rx="4" fill="#ffd700"/>
    <rect x="0" y="24" width="180" height="4" fill="#ffd700"/>
    <text x="10" y="19" font-family="system-ui, sans-serif" font-size="11" fill="rgba(44,49,67,0.6)">2:</text>
    <text x="26" y="19" font-family="system-ui, sans-serif" font-size="11" font-weight="600" fill="#2C3143">BAM Collection</text>
    <text x="90" y="55" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#495057">Aligned reads (STAR)</text>
    <text x="90" y="72" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#868e96">3'-biased RNA-seq BAMs</text>
    <circle cx="180" cy="45" r="6" fill="white" stroke="#ffd700" stroke-width="2"/>
  </g>

  <!-- NODE: StringTie (Processing - Blue) -->
  <g class="node-card" transform="translate(340, 100)">
    <rect width="200" height="90" rx="4" fill="white" stroke="#25537b" stroke-width="1"/>
    <rect width="200" height="28" rx="4" fill="#25537b"/>
    <rect x="0" y="24" width="200" height="4" fill="#25537b"/>
    <text x="10" y="19" font-family="system-ui, sans-serif" font-size="11" fill="rgba(255,255,255,0.7)">3:</text>
    <text x="26" y="19" font-family="system-ui, sans-serif" font-size="11" font-weight="600" fill="white">StringTie</text>
    <text x="100" y="55" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#495057">Transcript assembly</text>
    <text x="100" y="72" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#868e96">De novo per-sample assembly</text>
    <circle cx="0" cy="45" r="6" fill="white" stroke="#25537b" stroke-width="2"/>
    <circle cx="200" cy="45" r="6" fill="white" stroke="#25537b" stroke-width="2"/>
  </g>

  <!-- NODE: StringTie Merge (Processing - Blue) -->
  <g class="node-card" transform="translate(620, 100)">
    <rect width="200" height="90" rx="4" fill="white" stroke="#25537b" stroke-width="1"/>
    <rect width="200" height="28" rx="4" fill="#25537b"/>
    <rect x="0" y="24" width="200" height="4" fill="#25537b"/>
    <text x="10" y="19" font-family="system-ui, sans-serif" font-size="11" fill="rgba(255,255,255,0.7)">4:</text>
    <text x="26" y="19" font-family="system-ui, sans-serif" font-size="11" font-weight="600" fill="white">StringTie Merge</text>
    <text x="100" y="55" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#495057">Merge transcripts</text>
    <text x="100" y="72" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#868e96">Consensus across samples</text>
    <circle cx="0" cy="45" r="6" fill="white" stroke="#25537b" stroke-width="2"/>
    <circle cx="200" cy="45" r="6" fill="white" stroke="#25537b" stroke-width="2"/>
  </g>

  <!-- NODE: BREW3R.r (Processing - Blue, key step) -->
  <g class="node-card" transform="translate(890, 120)">
    <rect width="200" height="90" rx="4" fill="white" stroke="#25537b" stroke-width="1.5"/>
    <rect width="200" height="28" rx="4" fill="#25537b"/>
    <rect x="0" y="24" width="200" height="4" fill="#25537b"/>
    <text x="10" y="19" font-family="system-ui, sans-serif" font-size="11" fill="rgba(255,255,255,0.7)">5:</text>
    <text x="26" y="19" font-family="system-ui, sans-serif" font-size="11" font-weight="700" fill="white">BREW3R.r</text>
    <text x="100" y="55" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#495057">Extend 3' UTR boundaries</text>
    <text x="100" y="72" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#868e96">Evidence-based extension</text>
    <circle cx="0" cy="45" r="6" fill="white" stroke="#25537b" stroke-width="2"/>
    <circle cx="100" cy="90" r="5" fill="white" stroke="#25537b" stroke-width="1.5"/>
  </g>

  <!-- NODE: Extended GTF (Output - Orange) -->
  <g class="node-card" transform="translate(940, 310)">
    <rect width="120" height="50" rx="4" fill="white" stroke="#f97316" stroke-width="1.5"/>
    <rect width="120" height="20" rx="4" fill="#f97316"/>
    <rect x="0" y="16" width="120" height="4" fill="#f97316"/>
    <text x="60" y="14" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" font-weight="600" fill="white">Extended GTF</text>
    <text x="60" y="38" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#868e96">3' UTR extended</text>
    <circle cx="50" cy="0" r="5" fill="white" stroke="#f97316" stroke-width="2"/>
  </g>

  <!-- Legend -->
  <g transform="translate(250, 385)">
    <text x="0" y="0" font-family="system-ui, sans-serif" font-size="10" font-weight="600" fill="#495057">Legend:</text>
    <rect x="60" y="-10" width="14" height="14" rx="2" fill="white" stroke="#ffd700" stroke-width="1.5"/>
    <text x="80" y="0" font-family="system-ui, sans-serif" font-size="9" fill="#6c757d">Input</text>
    <line x1="120" y1="-4" x2="160" y2="-4" stroke="#25537b" stroke-width="4" stroke-linecap="round"/>
    <text x="168" y="0" font-family="system-ui, sans-serif" font-size="9" fill="#6c757d">Data flow</text>
    <rect x="240" y="-10" width="14" height="14" rx="2" fill="white" stroke="#f97316" stroke-width="1.5"/>
    <text x="260" y="0" font-family="system-ui, sans-serif" font-size="9" fill="#6c757d">Output</text>
  </g>

</svg>